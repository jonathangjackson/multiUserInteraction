<html>
    <head>
        <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v5.0.1/dist/aframe-extras.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
        <script src="easyrtc/easyrtc.js"></script>
        <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>    
        <script>
            AFRAME.registerComponent('game-controls',{
                schema: {
                    
                },

                init: function () {
                    const Context_AF = this;
                    Context_AF.shot();
                },

                shot: function() {
                
                    var myVar;
                    const Context_AF = this;
                }
            });
            function keyPress(event){
                
                var x = event.key;
                console.log(x);
                switch(x){
                   case ' ':
                        console.log("space");
                        var myVar;
                        if(document.getElementById('shot') !== null)    
                            document.getElementById('shot').parentNode.removeChild(document.getElementById('shot')); 
                        
                        var shot = document.createElement('a-sphere');
                            
                    const Context_AF = this;
                        var camPos = document.getElementById("camera").getAttribute('position');
                        shot.setAttribute('id', 'shot');
                        shot.setAttribute('position', {x: camPos.x, y: camPos.y, z: camPos.z});
                        shot.setAttribute('mixin', 'shot-mixin');
                        scene.appendChild(shot);
                        //document.querySelector("#swing").setAttribute("spring", "target", "#piderman");
                        myVar = setInterval(shoot, 1000);
                   break;
                }
            }

            function shoot(){
                document.querySelector("#shot").removeAttribute("spring");
                document.querySelector("#shot").removeAttribute("spring__left");
                document.querySelector("#shot").removeAttribute("spring__right");
            }

        </script>
    </head>
    <body onkeydown="keyPress(event)">
        <a-scene id="scene" networked-scene=" app: myApp; room: room1; debug: true;" physics="debug: true;">
            <a-assets>
                <a-asset-item id="jenga-obj" src="assets/objects/jengaBlock.obj"></a-asset-item>
                <a-mixin id="shot-mixin" dynamic-body="mass: 1" material="color: orange;" spring__left="target: #left-box" spring__right="target: #right-box"></a-mixin>

                <template id="avatar-template">
                    <a-entity class="avatar">
                        <a-sphere class="head" color="#5985ff" scale="0.45 0.5 0.4"></a-sphere>
                    </a-entity>
                </template>
            </a-assets>

            <a-sky color="#000000"></a-sky>
            <a-entity id="player" networked="template:#avatar-template;attachTemplateToLocal:false;" >
                <a-entity id="rig" >
                    <a-entity id="camera" wasd-controls camera look-controls="pointerLockEnabled: true"></a-entity>
                </a-entity>
            </a-entity>
            <a-box position="-1 2.6 -2" id="left-box" color="blue" static-body></a-box>
            <a-box position="3 2.6 -2" id="right-box" color="blue" static-body></a-box>
            <a-plane static-body="shape: width" height="100" width="100" position="0 -1 0" rotation="-90 0 0" ></a-plane>
        </a-scene>
    </body>
</html>