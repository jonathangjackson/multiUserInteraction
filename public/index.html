<html>
    <head>
        <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v5.0.1/dist/aframe-extras.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
        <script src="easyrtc/easyrtc.js"></script>
        <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>    
        <script>
            AFRAME.registerComponent('game-controls',{
                schema: {
                    bulletTemplate: {default: '#bullet-template'},
                },

                init: function () {
                    const Context_AF = this;
                    var obj = document.getElement
                    document.body.onkeyup = function(e){
                        if(e.keyCode == 32){
                            Context_AF.shot();
                        }
                    }
                },

                shot: function() {
                    var Context_AF = this;
                    var el = document.createElement('a-entity');
                    el.setAttribute('networked', 'template:' + this.data.bulletTemplate);//adding networkId       
                    el.setAttribute('position', {x: 0, y: 2, z: 0});
                    el.setAttribute('id', 'shot');
                    el.removeAttribute("spring");
                    el.removeAttribute("spring__left");
                    el.removeAttribute("spring__right");

                    var scene = document.querySelector('a-scene');
                    scene.appendChild(el);
                    //myVar = setInterval(function(){Context_AF.shootTimer(el)}, 1000);
                    
                },

                shootTimer: function(el){
                    el.removeAttribute("spring");
                    el.removeAttribute("spring__left");
                    el.removeAttribute("spring__right");
                }
            });
        </script>
    </head>
    <body>
        <a-scene id="scene" networked-scene=" room: shooter; debug: true;" physics="debug: true;"> 
            <a-assets>
                <template id="avatar-template">
                    <a-entity class="avatar">
                        <a-sphere class="head" scale="0.45 0.5 0.4" ></a-sphere>
                    </a-entity>
                </template>
                <template id="bullet-template">
                    <a-sphere class="bullet" id="swing" dynamic-body="mass: 1" scale="0.1 0.1 0.1" color="#fff" spring__left="target: #left-box" spring__right="target: #right-box"></a-sphere>
                </template>

            </a-assets>

            <a-sky color="#000000"></a-sky>
            
            <a-entity id="player" networked="template:#avatar-template" game-controls camera position="0 1.3 0" wasd-controls look-controls>
                <a-sphere class="head" color="#5985ff" visible="false"></a-sphere>
            </a-entity>

            <a-box position="-1 2.6 -2" id="left-box" color="blue" static-body></a-box>
            <a-box position="3 2.6 -2" id="right-box" color="blue" static-body></a-box>
            <a-plane static-body="shape: width" height="100" width="100" position="0 -1 0" rotation="-90 0 0" ></a-plane>
        </a-scene>
    </body>
</html>